---

stages:
- stage: Build

  jobs:
  - job: "Build containers for $(ARCH)"
    pool:
      vmImage: "ubuntu-16.04"
    strategy:
      matrix:
        armhf:
          arch: armhf
        arm64:
          arch: arm64
        i386:
          arch: i386
        amd64:
          arch: amd64
    steps:
    - script: docker run --rm --privileged multiarch/qemu-user-static:register --reset
      displayName: Register QEMU wrappers
    - checkout: self
      fetchDepth: 1
    - script: |
        docker build -t "pqclean/ci-container:$(arch)" --build-arg "ARCH=$(arch)" debian-buster
      displayName: Build container
